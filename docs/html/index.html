<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>qiti: qiti</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">qiti<span id="projectnumber">&#160;0.0.1</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">qiti </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> </p><div class="image">
<img src="logo.png" alt=""/>
</div>
    <p>Qiti is a lightweight C++20 library that brings profiling and instrumentation directly into your unit tests.</p>
<p>By integrating seamlessly with your test framework of choice, Qiti lets you track custom metrics and gather performance insights without ever leaving your test suite.</p>
<p>Qiti also provides optional Thread Sanitizer wrapper functionality: when enabled, tests can be run in isolation under TSan, automatically detecting data races and other thread-safety issues. You can even enforce custom thread-safety behavior right from your test code, catching concurrency bugs early in CI.</p>
<h1>Requirements</h1>
<ul>
<li>Clang or Apple Clang (no other compiler is supported)*</li>
<li>macOS (14 or 15, x86_64 and/or arm64)*</li>
<li>Linux (tested on Ubuntu, Debian, and Fedora; x86_64)* <br  />
</li>
<li>Windows (experimental/work-in-progress; x86_64, ThreadSanitizer features not supported)*</li>
<li>C++20</li>
<li>CMake**</li>
</ul>
<p>*see "Platform &amp; Compiler Test Matrix" below **see "Manual Integration" below for instructions to integrate without CMake</p>
<h1>CMake Integration</h1>
<p>Note: Qiti should not be linked in your final release builds. You will likely need to add a flag to your CMake invocation (e.g. -DQiti=1) to only link into your project when building your unit test executable, independent of your regular builds.</p>
<h2>ThreadSanitizer Support</h2>
<p>Qiti provides the <code><a class="el" href="classqiti_1_1_thread_sanitizer.html">qiti::ThreadSanitizer</a></code> class with multiple detection capabilities:</p>
<ul>
<li>**<code>createFunctionsCalledInParallelDetector()</code>** - Always available, uses function call tracking</li>
<li>**<code>createPotentialDeadlockDetector()</code>** - Uses custom lock-order tracking on macOS, requires Clang ThreadSanitizer on Linux</li>
<li>**<code>createDataRaceDetector()</code>** - Requires Clang ThreadSanitizer, uses TSan for data race detection</li>
</ul>
<p>To enable TSan-dependent functionality (<code>createDataRaceDetector()</code> and <code>createPotentialDeadlockDetector()</code> on Linux), add <code>-DQITI_ENABLE_CLANG_THREAD_SANITIZER=ON</code> to your CMake configuration:</p>
<div class="fragment"><div class="line">cmake -B build . -DQITI_ENABLE_CLANG_THREAD_SANITIZER=ON</div>
</div><!-- fragment --><p>When enabled, this adds ThreadSanitizer compiler flags (<code>-fsanitize=thread</code>, <code>-fno-inline</code>) and makes TSan-dependent functionality available. Note: This option is not supported on Windows.</p>
<p>When building on macOS with <code>QITI_ENABLE_CLANG_THREAD_SANITIZER=ON</code>, do not build universal binaries (arm64 + x86_64). ThreadSanitizer is incompatible with universal binaries. Build for your target architecture only.</p>
<h2>Project Integration</h2>
<p>To integrate Qiti into your CMake-based project, add Qiti as a subdirectory and link against the <code>qiti_lib</code> target provided by the library:</p>
<div class="fragment"><div class="line"># Add Qiti to your project</div>
<div class="line">add_subdirectory(path/to/qiti)</div>
<div class="line"> </div>
<div class="line"># Create your unit test executable (e.g. Catch2)</div>
<div class="line">add_executable(my_tests</div>
<div class="line">    tests/test_my_component.cpp</div>
<div class="line">    # etc.</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># Link any intermediary libraries you build (and wish to profile/instrument) with qiti_lib</div>
<div class="line">target_link_libraries(my_lib</div>
<div class="line">    PRIVATE</div>
<div class="line">        qiti_lib                # General Qiti library target</div>
<div class="line">        Catch2::Catch2WithMain  # (or your chosen test framework)</div>
<div class="line">        # etc.</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"># Link your final unit test executable with qiti_lib and qiti_tests_client</div>
<div class="line">target_link_libraries(my_tests</div>
<div class="line">    PRIVATE</div>
<div class="line">        qiti_lib                # General Qiti library target</div>
<div class="line">        qiti_tests_client       # Qiti target specific to final executable</div>
<div class="line">        Catch2::Catch2WithMain  # (or your chosen test framework)</div>
<div class="line">        # etc.</div>
<div class="line">)</div>
</div><!-- fragment --><h2>CMake Settings</h2>
<p>By linking against <code>qiti_lib</code>, Qiti automatically propagates:</p>
<ul>
<li><b>Include directories</b>: <code>./include</code></li>
<li><b>Core compiler flags</b> (via <code>INTERFACE</code>):<ul>
<li><code>-finstrument-functions</code> (enable function instrumentation)</li>
<li><code>-fno-omit-frame-pointer</code> (preserve frame pointers)</li>
<li><code>-g</code> (generate debug symbols)</li>
</ul>
</li>
<li><b>ThreadSanitizer flags</b> (when <code>QITI_ENABLE_CLANG_THREAD_SANITIZER=ON</code>):<ul>
<li><code>-fsanitize=thread</code> (enable Thread Sanitizer)</li>
<li><code>-fno-inline</code> (prevent inlining for TSan accuracy)</li>
</ul>
</li>
<li><b>ThreadSanitizer linker flags</b> (when enabled):<ul>
<li><code>-fsanitize=thread</code></li>
</ul>
</li>
</ul>
<p>You do not need to add these flags yourself‚Äîjust ensure you are using Clang with C++20.</p>
<p>In addition, by linking your unit test executable with <code>qiti_tests_client</code>, Qiti automatically propagates:</p>
<ul>
<li><b>Object File</b>: <code>./source/client/qiti_client_executable.cpp</code></li>
<li><b>Linker flags</b> (via <code>INTERFACE</code>):<ul>
<li><code>-rdynamic</code></li>
</ul>
</li>
</ul>
<h1>Manual Integration (Non-CMake Projects)</h1>
<p><b>‚ö†Ô∏è Note</b>: Manual integration is untested and you may experience issues. CMake integration is strongly recommended.</p>
<p>For projects not using CMake, you'll need to manually build the Qiti library and configure your build system:</p>
<h3>Step 1: Build the Qiti Library</h3>
<div class="fragment"><div class="line"># Build qiti_lib shared library from all source/qiti_*.cpp files</div>
<div class="line">clang++ -std=c++20 -shared -fPIC \</div>
<div class="line">    -finstrument-functions -fno-omit-frame-pointer -g \</div>
<div class="line">    -I./include -I./source \</div>
<div class="line">    source/qiti_*.cpp \</div>
<div class="line">    -o libqiti.so  # or .dylib on macOS</div>
</div><!-- fragment --><h3>Step 2: Configure Your Test Executable Build</h3>
<p><b>Include in your project:</b></p><ul>
<li>Add <code>source/client/qiti_client_executable.cpp</code> to your test executable's source files</li>
</ul>
<p><b>Required compiler flags:</b></p><ul>
<li><code>-std=c++20</code></li>
<li><code>-finstrument-functions -fno-omit-frame-pointer -g</code></li>
<li><code>-I./path/to/qiti/include</code> (for <code>qiti_include.hpp</code>)</li>
</ul>
<p><b>Required linker flags:</b></p><ul>
<li><code>-L./path/to/qiti -lqiti</code> (link the Qiti library)</li>
<li><code>-rdynamic</code></li>
</ul>
<p><b>Optional ThreadSanitizer support:</b></p><ul>
<li>Add <code>-fsanitize=thread -fno-inline -DQITI_ENABLE_CLANG_THREAD_SANITIZER=1</code> to both compiler and linker flags</li>
</ul>
<h3>Requirements Summary:</h3>
<ul>
<li><b>Clang compiler</b> (Apple Clang or LLVM Clang)</li>
<li><b>C++20 standard</b></li>
<li><b>Include qiti_client_executable.cpp</b> in your test executable</li>
<li><b>Link against libqiti</b> shared library</li>
<li><b>Apply required compiler/linker flags</b> above</li>
</ul>
<p>For complex projects, consider using CMake's <code>FetchContent</code> to automatically handle Qiti integration.</p>
<h1>Deployment Target (macOS)</h1>
<ul>
<li>When compiling on macOS, the deployment target must be 10.15 (Catalina) or later.</li>
</ul>
<h1>Platform &amp; Compiler Test Matrix</h1>
<p>Qiti is continuously tested across a comprehensive matrix of platforms, compilers, and configurations to ensure reliability and compatibility:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Platform   </th><th class="markdownTableHeadNone">OS Version   </th><th class="markdownTableHeadNone">Compiler   </th><th class="markdownTableHeadNone">Build System   </th><th class="markdownTableHeadNone">ThreadSanitizer   </th><th class="markdownTableHeadNone">Test Frameworks    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>macOS</b>   </td><td class="markdownTableBodyNone">14   </td><td class="markdownTableBodyNone">Apple Clang (Xcode 15.4)   </td><td class="markdownTableBodyNone">Xcode   </td><td class="markdownTableBodyNone">‚úÖ Enabled   </td><td class="markdownTableBodyNone">Catch2 + GTest    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>macOS</b>   </td><td class="markdownTableBodyNone">15   </td><td class="markdownTableBodyNone">Apple Clang (Xcode 16.2)   </td><td class="markdownTableBodyNone">Xcode   </td><td class="markdownTableBodyNone">‚úÖ Enabled   </td><td class="markdownTableBodyNone">Catch2 + GTest    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>macOS</b>   </td><td class="markdownTableBodyNone">15   </td><td class="markdownTableBodyNone">LLVM Clang 16   </td><td class="markdownTableBodyNone">Ninja   </td><td class="markdownTableBodyNone">‚úÖ Enabled   </td><td class="markdownTableBodyNone">Catch2 + GTest    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Ubuntu</b>   </td><td class="markdownTableBodyNone">Latest   </td><td class="markdownTableBodyNone">LLVM Clang 16   </td><td class="markdownTableBodyNone">Ninja   </td><td class="markdownTableBodyNone">‚úÖ Enabled   </td><td class="markdownTableBodyNone">Catch2 + GTest    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Ubuntu</b>   </td><td class="markdownTableBodyNone">Latest   </td><td class="markdownTableBodyNone">LLVM Clang 16   </td><td class="markdownTableBodyNone">Ninja   </td><td class="markdownTableBodyNone">‚ùå Disabled   </td><td class="markdownTableBodyNone">Catch2 + GTest    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Debian</b>   </td><td class="markdownTableBodyNone">Stable   </td><td class="markdownTableBodyNone">LLVM Clang 17   </td><td class="markdownTableBodyNone">Ninja   </td><td class="markdownTableBodyNone">‚úÖ Enabled   </td><td class="markdownTableBodyNone">Catch2 + GTest    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Fedora</b>   </td><td class="markdownTableBodyNone">Latest   </td><td class="markdownTableBodyNone">LLVM Clang (latest)   </td><td class="markdownTableBodyNone">Ninja   </td><td class="markdownTableBodyNone">‚úÖ Enabled   </td><td class="markdownTableBodyNone">Catch2 + GTest    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Windows</b>   </td><td class="markdownTableBodyNone">Latest   </td><td class="markdownTableBodyNone">LLVM Clang 16   </td><td class="markdownTableBodyNone">Ninja   </td><td class="markdownTableBodyNone">‚ùå Disabled   </td><td class="markdownTableBodyNone">Catch2   </td></tr>
</table>
<p><b>Additional CI Validations:</b></p><ul>
<li><b>Code Quality</b>: CPPLint validation with custom filters</li>
<li><b>Architecture</b>: x86_64 (macOS: also arm64)</li>
<li><b>Build Type</b>: Release builds across all configurations</li>
<li><b>C++ Standard</b>: C++20 compliance validation</li>
</ul>
<p>This comprehensive testing matrix ensures Qiti works reliably across the development environments and deployment targets most commonly used for C++ unit testing and profiling workflows.</p>
<h1>Documentation</h1>
<p>üìñ <b>API Documentation</b></p>
<p>Complete API documentation is included in this repository. To view it:</p>
<ol type="1">
<li>Clone or download this repository <br  />
</li>
<li>Open <code>docs/html/index.html</code> in your browser</li>
<li>Browse the full API reference, including all classes, functions, and usage examples</li>
</ol>
<h1>Quick Start</h1>
<p>In your unit test file, add </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &quot;qiti_include.hpp&quot;</div>
</div><!-- fragment --><p>Then in each unit test you wish to use Qiti, add a <a class="el" href="classqiti_1_1_scoped_qiti_test.html">qiti::ScopedQitiTest</a> at the top of the test. For example: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">TEST_CASE(&quot;Example Test&quot;)</div>
<div class="line">{</div>
<div class="line">    qiti::ScopedQitiTest test;</div>
<div class="line">    </div>
<div class="line">    // your test code here</div>
<div class="line">}</div>
</div><!-- fragment --><p> Even if you don't call any functions of ScopedQitiTest directly, instantiating it still enables most of the functionality of Qiti and cleans up the state once the test ends.</p>
<h2>Basic Tests</h2>
<p>Number of times called. </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">TEST_CASE(&quot;Example Test&quot;)</div>
<div class="line">{</div>
<div class="line">    qiti::ScopedQitiTest test;</div>
<div class="line">        </div>
<div class="line">    // Profile one of your functions</div>
<div class="line">    auto funcData = qiti::FunctionData::getFunctionData&lt;&amp;myFunc&gt;();</div>
<div class="line">    REQUIRE(funcData != nullptr);</div>
<div class="line">    </div>
<div class="line">    // Call twice</div>
<div class="line">    myFunc();</div>
<div class="line">    myFunc();</div>
<div class="line"> </div>
<div class="line">    // Enforce that it was indeed called twice</div>
<div class="line">    CHECK(funcData-&gt;getNumTimesCalled() == 2);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Enforce number of heap allocations. </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">TEST_CASE(&quot;Example Test&quot;)</div>
<div class="line">{    </div>
<div class="line">    qiti::ScopedQitiTest test;</div>
<div class="line">    </div>
<div class="line">    // Profile one of your functions</div>
<div class="line">    auto funcData = qiti::FunctionData::getFunctionData&lt;&amp;myFunc&gt;();</div>
<div class="line">    REQUIRE(funcData != nullptr);</div>
<div class="line">    </div>
<div class="line">    // Call function</div>
<div class="line">    funcData();</div>
<div class="line"> </div>
<div class="line">    // Get information on last function call</div>
<div class="line">    auto lastFunctionCall = funcData-&gt;getLastFunctionCall();</div>
<div class="line"> </div>
<div class="line">    // Enforce that this function does not heap allocate</div>
<div class="line">    REQUIRE(lastFunctionCall.getNumHeapAllocations() == 0);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Enforce length of test. </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">TEST_CASE(&quot;Example Test&quot;)</div>
<div class="line">{    </div>
<div class="line">    qiti::ScopedQitiTest test;</div>
<div class="line">    </div>
<div class="line">    // test code here</div>
<div class="line"> </div>
<div class="line">    // Ensure that the test does not take too long</div>
<div class="line">    REQUIRE(test.getLengthOfTest_ms() &lt; 10);</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Thread Sanitizer Tests</h2>
<p>Detect data races (requires <code>QITI_ENABLE_CLANG_THREAD_SANITIZER=ON</code>). </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">#ifdef QITI_ENABLE_CLANG_THREAD_SANITIZER</div>
<div class="line">TEST_CASE(&quot;Example Test&quot;)</div>
<div class="line">{</div>
<div class="line">    qiti::ScopedQitiTest test;</div>
<div class="line"> </div>
<div class="line">    auto dataRaceDetector = qiti::ThreadSanitizer::createDataRaceDetector();</div>
<div class="line">    auto codeToTest = []()</div>
<div class="line">    {</div>
<div class="line">        std::thread t([]</div>
<div class="line">        {</div>
<div class="line">            functionToRunOnThread0();</div>
<div class="line">        });</div>
<div class="line">        functionToRunOnThread1();</div>
<div class="line">        t.join();</div>
<div class="line">    };</div>
<div class="line">    dataRaceDetector-&gt;run(codeToTest);</div>
<div class="line">    REQUIRE(dataRaceDetector-&gt;passed()); // No data races detected</div>
<div class="line">}</div>
<div class="line">#endif</div>
</div><!-- fragment --><p>Please refer to the documentation for a full overview of all available features.</p>
<h1>License</h1>
<p>Qiti is licensed under the [MIT License](LICENSE). </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
